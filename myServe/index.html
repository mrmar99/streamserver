<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div id="confirmationModal" style="display: none;">
    <span>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫—É?</span>
    <div style="display: flex;gap:10px;">
      <button id="confirmDeleteBtn">–î–∞</button>
      <button id="cancelDeleteBtn">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
  <div class="container">
    <div class="controls">
      <div class="btn create-folder">üìÅ –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</div>
      <div class="btn upload">üíæ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</div>
      <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" id="fileInput" data-folderPath="" style="display:none;">
        <input type="hidden" name="folderPath" id="folderPathInput" value="">
      </form>
    </div>
    <div class="files">
      <a class="item home">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a class="item back">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
      <div class="files-row">
        <a class="item dir">Better Call Saul</a>
        <span class="item-edit">üñäÔ∏è</span>
        <span class="item-delete">‚ùå</span>
      </div>
      <div class="files-row">
        <a class="item dir">Breaking Bad</a>
        <span class="item-edit">üñäÔ∏è</span>
        <span class="item-delete">‚ùå</span>
      </div>
      <div class="files-row">
        <a class="item dir">True Detective</a>
        <span class="item-edit">üñäÔ∏è</span>
        <span class="item-delete">‚ùå</span>
      </div>
      <div class="files-row">
        <a class="item dir">Big Bang Theory</a>
        <span class="item-edit">üñäÔ∏è</span>
        <span class="item-delete">‚ùå</span>
      </div>
      <div class="files-row">
        <a class="item file">5.mp4</a>
        <span class="item-edit">üñäÔ∏è</span>
        <span class="item-delete">‚ùå</span>
      </div>
      <div class="empty">
        –ó–¥–µ—Å—å –ø—É—Å—Ç–æ
      </div>
    </div>
  </div>

  <style>
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #1c1c2a;
      color: rgb(239, 239, 239);
      font-size: 20px;
      font-family: 'Courier New', Courier, monospace;
      user-select: none;
    }

    .container {
      padding: 48px;
    }

    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
    }

    .btn {
      background-color: #4646be;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color .2s ease-in;
      font-size: 16px;
    }

    .btn:hover {
      background-color: #3737b9;
      transition: background-color .2s ease-out;
    }

    .files {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .home,
    .back {
      color: rgb(183, 238, 255);
      font-weight: 600;
    }

    .files-row {
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .files-row .item-edit,
    .files-row .item-delete {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background-color: #131321;
      cursor: pointer;
      transition: background-color .2s ease-in;
      border-radius: 0 12px 12px 0;
      padding: 16px;
    }

    .files-row .item-edit {
      border-radius: 0;
    }

    .files-row .item-edit:hover,
    .files-row .item-delete:hover {
      background-color: #14142b;
      transition: background-color .2s ease-out;
    }

    .item {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      background-color: #131321;
      padding: 16px;
      cursor: pointer;
      transition: background-color .2s ease-in;
      text-decoration: none;
      color: rgb(239, 239, 239);
      border-radius: 12px;
    }

    @media screen and (max-width: 500px) {
      .item {
        font-size: 16px;
      }

      .files-row .item-edit,
      .files-row .item-delete {
        padding: 4px;
        border-radius: 5px;
      }

      .files-row {
        gap: 5px;
      }
    }

    .item:hover {
      background-color: #14142b;
      transition: background-color .2s ease-out;
    }

    .dir,
    .file {
      position: relative;
      border-radius: 12px 0 0 12px;
    }

    .dir span.item-delte,
    .file span.item-delte {
      position: absolute;
      right: 0;
    }

    .dir {
      position: relative;
    }

    .dir::before {
      content: 'üìÅ ';
    }

    .file::before {
      content: 'üíæ ';
    }

    .file {
      font-weight: 600;
      color: rgb(230, 117, 255);
    }

    .empty {
      margin-top: 24px;
      text-align: center;
      font-size: 24px;
      font-weight: 900;
    }

    #confirmationModal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #090914;
      width: 300px;
      z-index: 5;
      padding: 16px;
      border-radius: 8px;
      -webkit-box-shadow: 0px 0px 75px 100px rgba(0, 0, 0, 0.35);
      -moz-box-shadow: 0px 0px 75px 100px rgba(0, 0, 0, 0.35);
      box-shadow: 0px 0px 75px 100px rgba(0, 0, 0, 0.35);
    }

    #confirmationModal span {
      display: block;
      text-align: justify;
      width: 100%;
      margin-bottom: 16px;
    }

    #confirmationModal button {
      width: 100%;
      background-color: #4646be;
      padding: 8px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: rgb(239, 239, 239);
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const createFolderBtn = document.querySelector(".create-folder");
      const uploadBtn = document.querySelector(".upload");
      const fileInput = document.getElementById("fileInput");
      const deleteButtons = document.querySelectorAll(".item-delete");
      const confirmationModal = document.getElementById("confirmationModal");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
      const editButtons = document.querySelectorAll(".item-edit");

      let deleteTarget = null;
      deleteButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          deleteTarget = btn.previousElementSibling.previousElementSibling; // The element to be deleted
          confirmationModal.style.display = "block";
        });
      });

      createFolderBtn.addEventListener("click", async () => {
        console.log("Button clicked");

        const newFolderName = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏:");

        if (newFolderName) {
          const folderPath = window.location.pathname.replaceAll(' ', '+');
          const response = await fetch("/create-folder", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              folderPath: folderPath,
              newFolderName: newFolderName.replaceAll(' ', '+'),
            }),
          });

          if (response.ok) {
            console.log("–ü–∞–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞");
            location.reload();
          } else {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞–ø–∫–∏");
          }
        }
      });

      uploadBtn.addEventListener("click", () => {
        const folderPath = window.location.pathname.replaceAll(' ', '+');
        fileInput.dataset.folderPath = folderPath;
        fileInput.click();
      });

      fileInput.addEventListener("change", async () => {
        const file = fileInput.files[0];
        const folderPath = window.location.pathname.replaceAll(' ', '+');

        if (file) {
          const formData = new FormData();
          formData.append("folderPath", folderPath);
          formData.append("file", file);

          const response = await fetch("/upload", {
            method: "POST",
            body: formData
          });

          if (response.ok) {
            console.log("–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω");
            location.reload();
          } else {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞");
          }
        }
      });

      confirmDeleteBtn.addEventListener("click", async () => {
        const filePath = deleteTarget.getAttribute("href");
        const response = await fetch("/delete", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ filePath }),
        });

        if (response.ok) {
          console.log("–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã");
          location.reload();
        } else {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏");
        }

        confirmationModal.style.display = "none";
      });

      cancelDeleteBtn.addEventListener("click", () => {
        deleteTarget = null;
        confirmationModal.style.display = "none";
      });

      editButtons.forEach((btn) => {
        btn.addEventListener("click", async () => {
          const targetElement = btn.previousElementSibling;

          const newName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:", targetElement.textContent);

          if (newName !== null && newName !== "") {
            targetElement.textContent = newName;

            const filePath = targetElement.getAttribute("href");
            const response = await fetch("/update", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ filePath, newName }),
            });

            if (response.ok) {
              console.log("–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
            } else {
              console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏");
            }
          }
          location.reload();
        });
      });
    });
  </script>
</body>

</html>